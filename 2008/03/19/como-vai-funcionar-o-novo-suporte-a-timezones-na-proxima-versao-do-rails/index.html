
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Como vai funcionar o novo suporte a TimeZones na próxima versão do Rails? - Nome do Jogo</title>
  <meta name="author" content="Carlos Brando">

  
  <meta name="description" content="Não sabemos ainda quando a versão 2.1(?) do Rails sairá, mas quem acompanha este blog já sabe das grandes novidades que acompanharão esta nova &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://nomedojogo.com/2008/03/19/como-vai-funcionar-o-novo-suporte-a-timezones-na-proxima-versao-do-rails">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/bootstrap.min.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/custom.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="http://feeds2.feedburner.com/NomeDoJogo" rel="alternate" title="Nome do Jogo" type="application/atom+xml">
  <!--Fonts from Google's Web font directory at http://google.com/webfonts -->
<link href='http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic' rel='stylesheet' type='text/css'>

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-1249636-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >

  <header class="main">
    <div class="container">
	<div class="row">
		<div class="span8 title">
			<h2>Carlos Brando</h2>
			<h1><a href="/">Nome do Jogo</a></h1>
		
			<ul class="header-list">
				<li class="title">Acompanhe também</li>
				<li class="grokpodcast"><a href="http://grokpodcast.com/">Grok Podcast</a></li>
			</ul>
		</div>
		<div class="span4 seach_form">
			
			<form action="http://google.com/search" method="get">
				<fieldset role="search">
					<input type="hidden" name="q" value="site:nomedojogo.com" />
					<input class="search" type="text" name="q" results="0" placeholder="Pesquisar"/>
				</fieldset>
			</form>
			
		</div>
	</div>
</div>

  </header>
  
  <!-- <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="http://feeds2.feedburner.com/NomeDoJogo" rel="subscribe-rss" title="assine via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:nomedojogo.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Pesquisar"/>
  </fieldset>
</form>
  
<ul role=main-navigation>
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Arquivo</a></li>
</ul>

</nav> -->
  
  <section class="container">
    <div id="main">
      <div id="content">
        <div>










<article class="hentry" role="article" >
  
  <header>
    <h1 class="entry-title">

Como vai funcionar o novo suporte a TimeZones na próxima versão do Rails?

</h1>

    
      <p class="meta">
        








  


<time datetime="2008-03-19T00:00:00-03:00" pubdate data-updated="true">19 de Março de 2008</time>
        
        <a rel="bookmark" href="/2008/03/19/como-vai-funcionar-o-novo-suporte-a-timezones-na-proxima-versao-do-rails/"></a>
      </p>
    
  </header>



  <div class="entry-content"><p><img src="http://old.nomedojogo.com/wp-content/uploads/2008/03/103050700_09e2ff6b95.jpg" alt="103050700_09e2ff6b95.jpg" /></p>

<p>Não sabemos ainda quando a versão 2.1(?) do Rails sairá, mas quem acompanha este blog já sabe das grandes novidades que acompanharão esta nova versão. Acredito que a mais interessante e importante novidade será o novo suporte nativo a timezones.</p>

<p>Criar um sistema que trabalha com fusos-horários diferentes hoje só é possível graças a gems como o <strong>TZInfo</strong>. Mas isto será trivial na próxima versão do Rails.</p>

<p>Para entender a necessidade disto, imagine um sistema simples para uma empresa de cursos de idiomas online, onde alunos do mundo todo podem agendar horários para suas aulas. Se eu agendar uma aula aqui para uma hora da tarde, meu professor que mora no Canadá deve ser avisado que a aula ocorrerá às dez horas da manhõ no horário dele. Se isto não acontecer, teremos uma tremenda confusão e um sistema assim seria um fracasso.</p>

<p>A solução para o problema é sempre convertermos os horários para o padrão UTC e na hora de exibir ou receber usarmos a hora local do usuário. Consegue imaginar o problema? Que problema? Isto será trivial, assim:</p>

<pre class="textmate-source"><span class="source source_ruby source_ruby_rails"><span class="comment comment_line comment_line_number-sign comment_line_number-sign_ruby"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_ruby">#</span> informa o fuso-horário local
</span><span class="support support_class support_class_ruby">Time</span><span class="punctuation punctuation_separator punctuation_separator_method punctuation_separator_method_ruby">.</span>zone <span class="keyword keyword_operator keyword_operator_assignment keyword_operator_assignment_ruby">=</span> <span class="string string_quoted string_quoted_double string_quoted_double_ruby"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_ruby">"</span>Pacific Time (US &amp; Canada)<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_ruby">"</span></span>

<span class="comment comment_line comment_line_number-sign comment_line_number-sign_ruby"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_ruby">#</span> Agora todas as datas/horas irão refletir o fuso-horário local
</span>event <span class="keyword keyword_operator keyword_operator_assignment keyword_operator_assignment_ruby">=</span> <span class="support support_class support_class_ruby">Event</span><span class="punctuation punctuation_separator punctuation_separator_method punctuation_separator_method_ruby">.</span><span class="keyword keyword_other keyword_other_special-method keyword_other_special-method_ruby">new</span>
event<span class="punctuation punctuation_separator punctuation_separator_method punctuation_separator_method_ruby">.</span>when <span class="keyword keyword_operator keyword_operator_assignment keyword_operator_assignment_ruby">=</span> <span class="support support_class support_class_ruby">Time</span><span class="punctuation punctuation_separator punctuation_separator_method punctuation_separator_method_ruby">.</span>utc<span class="punctuation punctuation_section punctuation_section_function punctuation_section_function_ruby">(</span><span class="constant constant_numeric constant_numeric_ruby">2008</span><span class="punctuation punctuation_separator punctuation_separator_object punctuation_separator_object_ruby">,</span> <span class="constant constant_numeric constant_numeric_ruby">1</span><span class="punctuation punctuation_separator punctuation_separator_object punctuation_separator_object_ruby">,</span> <span class="constant constant_numeric constant_numeric_ruby">1</span><span class="punctuation punctuation_separator punctuation_separator_object punctuation_separator_object_ruby">,</span> <span class="constant constant_numeric constant_numeric_ruby">0</span><span class="punctuation punctuation_section punctuation_section_function punctuation_section_function_ruby">)</span>
event<span class="punctuation punctuation_separator punctuation_separator_method punctuation_separator_method_ruby">.</span>when <span class="comment comment_line comment_line_number-sign comment_line_number-sign_ruby"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_ruby">#</span>=&gt; Mon, 31 Dec 2007 16:00:00 PST -08:00</span></span></pre>


<p>Para facilitar ainda mais podemos usar um filtro no <code>ApplicationController</code>, algo assim:</p>

<pre class="textmate-source"><span class="source source_ruby source_ruby_rails"><span class="meta meta_rails meta_rails_controller"><span class="meta meta_class meta_class_ruby"><span class="keyword keyword_control keyword_control_class keyword_control_class_ruby">class</span> <span class="entity entity_name entity_name_type entity_name_type_class entity_name_type_class_ruby">ApplicationController<span class="entity entity_other entity_other_inherited-class entity_other_inherited-class_ruby"> <span class="punctuation punctuation_separator punctuation_separator_inheritance punctuation_separator_inheritance_ruby">&lt;</span> ActionController::Base</span></span></span>
  <span class="support support_function support_function_actionpack support_function_actionpack_rails">before_filter</span> <span class="constant constant_other constant_other_symbol constant_other_symbol_ruby"><span class="punctuation punctuation_definition punctuation_definition_constant punctuation_definition_constant_ruby">:</span>set_timezone</span>

  <span class="meta meta_function meta_function_method meta_function_method_without-arguments meta_function_method_without-arguments_ruby"><span class="keyword keyword_control keyword_control_def keyword_control_def_ruby">def</span> <span class="entity entity_name entity_name_function entity_name_function_ruby">set_timezone</span></span>
<span class="comment comment_line comment_line_number-sign comment_line_number-sign_ruby">    <span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_ruby">#</span> current_user.time_zone #=&gt; 'Pacific Time (US &amp; Canada)'
</span>    <span class="support support_class support_class_ruby">Time</span><span class="punctuation punctuation_separator punctuation_separator_method punctuation_separator_method_ruby">.</span>zone <span class="keyword keyword_operator keyword_operator_assignment keyword_operator_assignment_ruby">=</span> current_user<span class="punctuation punctuation_separator punctuation_separator_method punctuation_separator_method_ruby">.</span>time_zone
  <span class="keyword keyword_control keyword_control_ruby">end</span>
</span><span class="keyword keyword_control keyword_control_ruby">end</span></span></pre>


<p>Pronto, problema resolvido.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Publicado por <span class="fn">Carlos Brando</span></span>

      








  


<time datetime="2008-03-19T00:00:00-03:00" pubdate data-updated="true">19 de Março de 2008</time>
      

<span class="categories">
  
    <a class='category' href='/categories/rails-2-1/'>Rails 2.1</a>, <a class='category' href='/categories/ruby-on-rails/'>Ruby on Rails</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://nomedojogo.com/2008/03/19/como-vai-funcionar-o-novo-suporte-a-timezones-na-proxima-versao-do-rails/" data-via="carlosbrando" data-counturl="http://nomedojogo.com/2008/03/19/como-vai-funcionar-o-novo-suporte-a-timezones-na-proxima-versao-do-rails/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/2008/03/18/ruby-on-rails-21/" title="Previous Post: Ruby on Rails 2.1">&laquo; Ruby on Rails 2.1</a>
      
      
        <a class="basic-alignment right" href="/2008/03/19/encontros-locaweb-de-profissionais-de-internet/" title="Next Post: Encontros Locaweb de Profissionais de Internet">Encontros Locaweb de Profissionais de Internet &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Artigos Recentes</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2012/04/09/how-i-do-my-computing/">How I do my Computing</a>
      </li>
    
      <li class="post">
        <a href="/2012/04/08/burnout/">Burnout</a>
      </li>
    
      <li class="post">
        <a href="/2012/04/06/enviando-o-link-da-pagina-atual-por-e-mail/">Enviando o link da página atual por e-mail</a>
      </li>
    
      <li class="post">
        <a href="/2012/04/05/heroku-add-ons-catalog/">Heroku Add-ons Catalog</a>
      </li>
    
      <li class="post">
        <a href="/2012/04/04/cldwalker-slash-debugger-github/">Finalmente um debug para o Ruby 1.9.3</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Atualizando...</li>
  </ul>
  
  <a href="https://github.com/carlosbrando">@carlosbrando</a> no GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'carlosbrando',
            count: 4,
            skip_forks: false,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Últimos Tweets</h1>
  <ul id="tweets">
    <li class="loading">Atualizando...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("carlosbrando", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/carlosbrando" class="twitter-follow-button" data-show-count="false">Siga @carlosbrando</a>
  
</section>


<section>
  <h1>Bookmarks</h1>
  <div id="delicious"></div>
  <script type="text/javascript" src="http://feeds.delicious.com/v2/json/cbrando?count=3&amp;sort=date&amp;callback=renderDeliciousLinks"></script>
  <p><a href="http://delicious.com/cbrando">Meus Bookmarks &raquo;</a></p>
</section>


<section class="googleplus googleplus-hidden">
  <h1>
    <a href="https://plus.google.com/109235566448786781079?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>



      </div>
    </div>
  </section>
  
  <!-- <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Carlos Brando -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer> -->
  

<script type="text/javascript">
      var disqus_shortname = 'carlosbrando';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://nomedojogo.com/2008/03/19/como-vai-funcionar-o-novo-suporte-a-timezones-na-proxima-versao-do-rails/';
        var disqus_url = 'http://nomedojogo.com/2008/03/19/como-vai-funcionar-o-novo-suporte-a-timezones-na-proxima-versao-do-rails/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
