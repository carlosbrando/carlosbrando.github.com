
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Nome do Jogo</title>
  <meta name="author" content="Carlos Brando">

  
  <meta name="description" content="O último artigo desta série levantou uma certa polêmica em alguns pontos. Quero deixar claro que entendo muito bem que existem situações em que não é &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://nomedojogo.com/page/12">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="http://feeds2.feedburner.com/NomeDoJogo" rel="alternate" title="Nome do Jogo" type="application/atom+xml">
  <!--Fonts from Google's Web font directory at http://google.com/webfonts -->
<link href='http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic' rel='stylesheet' type='text/css'>

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-1249636-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Nome do Jogo</a></h1>
  
    <h2>por Carlos Brando</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="http://feeds2.feedburner.com/NomeDoJogo" rel="subscribe-rss" title="assine via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:nomedojogo.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Pesquisar"/>
  </fieldset>
</form>
  
<ul role=main-navigation>
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Arquivo</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2009/02/27/rails-way-4-metodos-destrutivos-ou-somente-perigosos/">Rails Way #4: Métodos destrutivos ou somente perigosos?</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-02-27T00:00:00-03:00" pubdate data-updated="true">27 de Fevereiro de 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>O <a href="http://www.nomedojogo.com/2009/02/13/rails-way-3-nomes-de-metodos-e-variaveis-devem-ser-obvios/">último artigo</a> desta série levantou uma certa polêmica em alguns pontos. Quero deixar claro que entendo muito bem que existem situações em que não é possível ou mesmo prático utilizar as sugestões descritas aqui. Você não deve encarar esta série de artigos como um livro de leis, mas somente como boas práticas adotadas pela maior parte da comunidade de desenvolvedores Rails.</p>

<p>O que quero é exatamente isto, levantar discussões sobre o que é bom ou ruim e o que é realmente prático ou simplesmente moda.</p>

<p>Ao comentar sobre algumas boas práticas ao nomear métodos, mencionei sobre o uso dos sinais de exclamação (!) e interrogação (?) como uma forma de deixar os métodos mais descritivos. Meu erro talvez tenha ocorrido ao usar o nome ‘métodos destrutivos’ quando me referi aos métodos terminados com o sinal de exclamação.</p>

<p>Concordo em dizer que na verdade &#8216;!&#8217; no fim de um método não necessariamente significa &#8220;destrutivo&#8221;, mas sim que o método em questão é uma versão mais <strong>perigosa</strong> de um outro método com o mesmo nome, mas sem o sinal.</p>

<h2>Deixe-me explicar isto melhor</h2>


<p><img class="center" src="http://old.nomedojogo.com/wp-content/uploads/2009/02/2990809708_b26fb9ef8c.jpg"></p>

<p>O uso da expressão &#8216;método perigoso&#8217; é relativo. Dizer que um método terminado com ! é perigoso, não diz nada se você não possuir um outro método similar menos perigoso e sem o sinal de exclamação.</p>

<p>Assim, a regra número um é que todo método terminado com ! deve vir acompanhado de um outro método com o mesmo nome, mas sem o sinal.</p>

<p>No Ruby e também no Rails encontramos muitos casos assim. Por exemplo, temos o método <code>gsub!</code> que é <em>mais perigoso</em> que o seu companheiro <code>gsub</code>. Assim como também temos o método <code>exit!</code> que é a versão <em>mais perigosa</em> do método <code>exit</code>, e assim por diante.</p>

<p>Alguns acreditam que devem usar o sinal ! apenas quando o método alterar a sua própria instância. Embora muitos método perigosos façam isto, esta não a finalidade do sinal de exclamação. No próprio Ruby encontramos métodos que tem esta característica mas que não são considerados perigosos, como os métodos <code>Array#pop</code> e <code>Array#push</code>, apenas para citar alguns exemplos.</p>

<p>Devemos apenas fazer uso do sinal ! quando criarmos um método que represente mais perigo que outro já criado. Tome como exemplo os métodos <code>save</code> e <code>save!</code> do <code>ActiveRecord</code>. O primeiro método simplesmente grava o registro no banco de dados e retorna verdadeiro ou falso de acordo com o resultado do procedimento. Utilizando o segundo método, caso algo dê errado não teremos de volta apenas um booleano falso, teremos o disparo de uma exceção, o que pode representar um certo risco se o seu aplicativo não estiver preparado para isto. Desta forma podemos considerar este método <em>mais perigoso</em> que o primeiro, merecendo assim a adição do sinal ! no final de seu nome.</p>

<p>A conclusão é que o uso de &#8220;!&#8221; no nome de um método não dirá a você exatamente o que ele fará ou de que forma ele representa perigo. Mas o sinal de exclamação (!) é  importante como um alerta de que o método em questão pode representar algum risco se usado de forma impensada.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2009/02/17/um-modelo-de-maturidade-para-projetos-rails-e-pratico/">Um modelo de maturidade para projetos Rails é prático?</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-02-17T00:00:00-03:00" pubdate data-updated="true">17 de Fevereiro de 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Acredito que este seja o assunto da semana nas rodas de desenvolvedores Rails, e como tal eu não poderia deixar de dar minha opinião sobre o assunto.</p>

<p>Obie Fernandez - um personagem conhecido na comunidade Rails mundial graças ao seu famoso livro “The Rails Way”, sua empresa Hashrocket e também pela sua personalidade forte - vem criando uma certa polemica sobre a <a href="http://groups.google.com/group/rails-business/browse_thread/thread/e24cfda7947fda10">criação de um modelo para definir a maturidade de uma empresa</a> na criação de projetos Rails. A ideia original é criar um sistema parecido com o que seria um <a href="http://pt.wikipedia.org/wiki/CMM">CMM</a>, mas direcionado as melhores práticas de desenvolvimento em projeto Ruby on Rails.</p>

<p>O RMM descreveria os estágios de maturidade através dos quais as empresas de software teriam de passar afim de evoluir seus processos. Na concepção original estes estágios seriam divididos em níveis que iriam de 0 a 3:</p>

<p>RMM0</p>

<ul>
    <li> Nenhum processo formal de desenvolvimento</li>
    <li> Sem cobertura de testes</li>
    <li> Nenhum padrão de práticas de negócio</li>
    <li> Análise de falhas estática</li>
</ul>


<p>RMM1 e RMM2 deveriam ser alguma coisa intermediária, sendo que o RMM1 seria considerado negativo, enquanto o RMM2 seria considerado positivo.</p>

<p>RMM3:</p>

<ul>
    <li> Práticas ágeis de desenvolvimento de software</li>
    <li> 100% de cobertura com testes</li>
    <li> 100% de programação em pares</li>
    <li> Padrão formal de práticas de negócio</li>
    <li> Sistema de aprendizado contínuo e melhoria do processo</li>
    <li> Testemunhos positivos de clientes</li>
    <li> Aplicativos Rails implantados com sucesso</li>
    <li> Outros itens a serem definidos&#8230;</li>
</ul>


<p>Obviamente este itens são apenas ideias, muita coisa ainda estaria faltando se isto estivesse finalizado.</p>

<p>O grande problema levantado por Obie é que muitas empresas que desejam contratar profissionais ou terceirizar o desenvolvimento de softwares em Rails, tem dificuldade em identificar se uma determinada consultoria ou profissional são realmente bons. A criação de um selo como o RMM simplificaria este processo. Teoricamente bastaria o contratante verificar em qual nível do RMM a prospectiva empresa se encontra, e isto definiria a qualidade dos serviços prestados e traria segurança ao contratante.</p>

<p>É exatamente neste ponto que discordo totalmente de Obie. Possuir um “selo” de qualidade não indica realmente que a empresa é de qualidade. Existe muito mais envolvido nisso do que simplesmente adotar boas práticas.</p>

<p>A empresa pode adotar como regra todas as sugestões dadas no RMM e ainda assim contratar profissionais ruins e/ou desmotivados. Pode adotar o sistema de programação em pares de uma forma que não seja produtiva. Enfim, todos os itens são relativos. Acredito que a qualidade de um empresa depende muito mais dos profissionais contratados e do quão motivados eles estão, não desconsiderando nenhuma destas boas práticas.</p>

<p>Sim, RMM tem tudo a ver com <a href="http://www.nomedojogo.com/2007/09/11/ruby-on-rails-no-tem-futuro-corra-atrs-da-sua-certificao-enquanto-tempo/">certificações</a>. Talvez não pareça, mas no fundo o conceito é o mesmo. Uma certificação é como o exame de motorista. Minha esposa conseguiu tirar sua carta de motorista na primeira tentativa à alguns meses atrás, mas até hoje ela não consegue dirigir em uma avenida mais movimentada que temos perto de casa. Isto se dá porque as escolas não ensinam as pessoas a dirigir, mas sim a passar no exame de motorista.</p>

<p>O mesmo se dá com certificações, as pessoas estudam para passar na avaliação, mas isto não significa que estão preparadas para os desafios da vida real. Contratar um profissional somente pela certificação, seria como contratar uma pessoa que acabou de conseguir sua habilitação para ser o motorista de sua família.</p>

<p><img class="center" src="http://old.nomedojogo.com/wp-content/uploads/2009/02/345246158_d34e3a4b41.jpg"></p>

<p>Contratar uma empresa somente porque ela segue uma série de regras definidas por uma outra pessoa ou organização, e por isto conseguiu um “selo de qualidade” representa o mesmo tipo de risco.</p>

<p>Ao contratar uma empresa para desenvolver um software, seja em Rails ou em qualquer outra tecnologia, entre em contato com outros clientes que já foram atendidos pela empresa. Procure saber quais projetos criados pela empresa foram concluídos com sucesso. Tente descobrir mais sobre os profissionais que compõem o seu time de desenvolvimento. Esta é a melhor garantia de que você estará contratando a empresa certa para o sucesso do seu projeto.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2009/02/16/um-presente-para-a-comunidade-de-desenvolvedores-brasileiros-de-ruby-e-rails/">Um presente para a comunidade de desenvolvedores brasileiros de Ruby e Rails</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-02-16T00:00:00-03:00" pubdate data-updated="true">16 de Fevereiro de 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Temos ótimos blogueiros em nossa comunidade de programadores brasileiros e muitos artigos são escritos sobre os mais diversos assuntos relacionados ao Ruby e ao Rails. Mas eu sempre senti falta de uma fonte única de noticias sobre o que acontece no mundo Ruby on Rails aqui no Brasil.</p>

<p>A primeira tentativa de trazer isto aos desenvolvedores tupiniquins foi com o <a href="http://podcast.rubyonrails.pro.br/">Rails Podcast Brasil</a>, um podcast semanal com as principais noticias sobre novas bibliotecas, técnicas e polemicas que envolviam o Ruby on Rails. O podcast sempre foi um sucesso de audiência e chegou até a sua 39º edição. Mas o formato de podcast tinha alguns problemas: as noticias chegavam com uma semana de atraso, você precisava dedicar pelo menos uma hora para ouvir todas as noticias e ele também consumia muito tempo para ser produzido. Mesmo assim, não desanime, teremos novidades sobre o podcast em breve&#8230;</p>

<p>Durante um bom tempo meditei sobre qual seria a melhor maneira de trazer as noticias o mais rápido possível para a comunidade, de uma forma que até mesmo o mais ocupado desenvolvedor pudesse se atualizar rapidamente. Encontrei a solução na forma como eu mesmo resolvo este problema. Eu mantenho alguns sites em meu leitor de feeds e sempre que posso me atualizo, mas dou prioridade para sites que agregam noticias, como o famoso <a href="http://www.rubyinside.com/">Ruby Inside</a> de Peter Cooper.</p>

<p>O problema é que uma boa parte da nossa comunidade, principalmente os iniciantes não tem acesso a informações em inglês, e não existe nenhum site em português com o mesmo conteúdo de sites como <a href="http://www.rubyinside.com/">Ruby Inside</a> e <a href="http://www.railsinside.com/">Rails Inside</a>. Pensando nisso, no inicio do ano entrei em contato com Peter Cooper buscando uma forma de trazer o conteúdo destes sites para a comunidade brasileira. E consegui!</p>

<p>Agora tenho o prazer de anunciar o:</p>

<p><img class="center" src="http://old.nomedojogo.com/wp-content/uploads/2009/02/logo-br.gif"></p>

<p>O site é um franquia da edição americana do Ruby Inside, e trará para o público brasileiro os mesmos artigos publicados lá fora, totalmente em português. Além disso também teremos muito conteúdo nacional, com artigos escritos por desenvolvedores nacionais e uma cobertura completa de tudo o que acontece com Ruby e Rails por aqui.</p>

<p>Não estou sozinho nesta empreitada, conto com um time muito motivado e cheio de feras: Eliézer Pimentel, José Gomes, Levy Carneiro, Luís Gustavo e Rafael Rosa. Vocês irão conhecer cada um deles um pouco melhor no futuro com uma série de artigos que estou preparando sobre o projeto.</p>

<p>O <a href="http://www.rubyinside.com.br/">Ruby Inside Brasil</a> acabou de nascer, mas já conta com mais de 20 artigos traduzidos. Algumas empresas brasileiras, como a <a href="http://www.planobe.com.br/rubyonrails">Plano Bê</a>, também já tem demonstrado seu apoio pelo projeto.</p>

<p>Se você apóia a idéia, existe algumas coisas que você pode fazer, como espalhar a noticia de todas as formas possíveis, através do seu blog, twitter, contando para seus amigos, etc. Mas se você representa uma empresa, também pode patrocinar o site. Teremos o maior prazer em incluir um anúncio da sua empresa ou projeto em formato de banner nas páginas do <a href="http://www.rubyinside.com.br/">Ruby Inside Brasil</a>, para isto basta <a href="http://www.rubyinside.com.br/contato">entrar em contato conosco</a>.</p>

<p>Depois do Rails Podcast Brasil, do Rails Summit Latin America e tantos outros projetos de evangelização de Rails no Brasil, espero que este site possa ser o próximo passo em direção ao sucesso do Rails em nosso país.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2009/02/13/rails-way-3-nomes-de-metodos-e-variaveis-devem-ser-obvios/">Rails Way #3: Nomes de métodos e variáveis devem ser óbvios</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-02-13T00:00:00-02:00" pubdate data-updated="true">13 de Fevereiro de 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Não sou uma pessoa supersticiosa, mas hoje é sexta-feira (13) e é melhor não abusar, então vamos manter a tradição e comentar sobre mais um <em>rubismo</em>, ou se preferir, mais uma boa prática de programação que todos os desenvolvedores deveriam adotar independente da linguagem que usem.</p>

<p>Dar nomes para classes, módulos, métodos e variáveis é uma tarefa complicada em alguns casos. Com certeza você em algum momento de sua carreira já ficou na dúvida sobre que nome dar a um determinado método ou variável. Talvez até mesmo apelou para algum colega de trabalho em busca de alguma sugestão.</p>

<p>A regra é: <strong>o nome de uma classe, módulo, método ou variável deve ser o mais óbvio possível</strong>. Em muitos casos, um programador totalmente concentrado no código que está escrevendo não se apercebe de que o que lhe parece óbvio naquele momento, não será tão óbvio na segunda-feira, depois de um fim de semana com a família. E se ele próprio pode ficar um pouco perdido com nomes estranhos e abreviações, imagine quando um outro programador sem o contexto necessário for fazer uma manutenção naquele código.</p>

<p><img class="center" src="http://old.nomedojogo.com/wp-content/uploads/2009/02/water.jpg"></p>

<p>Andy Lester em 2004 escreveu em seu artigo “<a href="http://www.oreillynet.com/onlamp/blog/2004/03/the_worlds_two_worst_variable.html">The world&#8217;s two worst variable names</a>”, que o pior nome para se dar a uma variável é <code>data</code>. Como no exemplo abaixo:</p>

<pre class="textmate-source"><span class="source source_ruby source_ruby_rails">data <span class="keyword keyword_operator keyword_operator_assignment keyword_operator_assignment_ruby">=</span> <span class="support support_class support_class_ruby">User</span><span class="punctuation punctuation_separator punctuation_separator_method punctuation_separator_method_ruby">.</span>find<span class="punctuation punctuation_section punctuation_section_function punctuation_section_function_ruby">(</span><span class="constant constant_numeric constant_numeric_ruby">10</span><span class="punctuation punctuation_section punctuation_section_function punctuation_section_function_ruby">)</span>
puts <span class="string string_quoted string_quoted_double string_quoted_double_ruby"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_ruby">"</span>Nome: = <span class="source source_ruby source_ruby_embedded source_ruby_embedded_source"><span class="punctuation punctuation_section punctuation_section_embedded punctuation_section_embedded_ruby">#{</span>data<span class="punctuation punctuation_separator punctuation_separator_method punctuation_separator_method_ruby">.</span>name<span class="punctuation punctuation_section punctuation_section_embedded punctuation_section_embedded_ruby">}</span></span><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_ruby">"</span></span></span></pre>


<p>Eu já vi muito este tipo de coisa, e tenho certeza de que você também. Mas que droga de nome é este? É óbvio que o que está armazenado em uma variável é um dado (data), mas que tipo de dado, é a pergunta a ser feita. Neste caso especifico renomear a variável para <code>user</code> já faria uma enorme diferença. Nomes como <code>data</code>, <code>ret</code> e <code>temp</code> não querem dizer nada.</p>

<p>Agora vem a melhor (ironicamente) parte, o segundo pior nome para se dar a uma variável é <code>data2</code> e suas variações. Veja só que coisa horrível:</p>

<pre class="textmate-source"><span class="source source_ruby source_ruby_rails">user  <span class="keyword keyword_operator keyword_operator_assignment keyword_operator_assignment_ruby">=</span> <span class="support support_class support_class_ruby">User</span><span class="punctuation punctuation_separator punctuation_separator_method punctuation_separator_method_ruby">.</span>find<span class="punctuation punctuation_section punctuation_section_function punctuation_section_function_ruby">(</span><span class="constant constant_numeric constant_numeric_ruby">10</span><span class="punctuation punctuation_section punctuation_section_function punctuation_section_function_ruby">)</span>
user2 <span class="keyword keyword_operator keyword_operator_assignment keyword_operator_assignment_ruby">=</span> <span class="support support_class support_class_ruby">User</span><span class="punctuation punctuation_separator punctuation_separator_method punctuation_separator_method_ruby">.</span>find<span class="punctuation punctuation_section punctuation_section_function punctuation_section_function_ruby">(</span><span class="constant constant_numeric constant_numeric_ruby">20</span><span class="punctuation punctuation_section punctuation_section_function punctuation_section_function_ruby">)</span>
puts <span class="string string_quoted string_quoted_double string_quoted_double_ruby"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_ruby">"</span>O <span class="source source_ruby source_ruby_embedded source_ruby_embedded_source"><span class="punctuation punctuation_section punctuation_section_embedded punctuation_section_embedded_ruby">#{</span>user<span class="punctuation punctuation_separator punctuation_separator_method punctuation_separator_method_ruby">.</span>name<span class="punctuation punctuation_section punctuation_section_embedded punctuation_section_embedded_ruby">}</span></span> é amigo do <span class="source source_ruby source_ruby_embedded source_ruby_embedded_source"><span class="punctuation punctuation_section punctuation_section_embedded punctuation_section_embedded_ruby">#{</span>user2<span class="punctuation punctuation_separator punctuation_separator_method punctuation_separator_method_ruby">.</span>name<span class="punctuation punctuation_section punctuation_section_embedded punctuation_section_embedded_ruby">}</span></span><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_ruby">"</span></span></span></pre>


<p>No exemplo acima estou usando um nome descritivo, mas qual é a diferença entre <code>user</code> e <code>user2</code>? Eu preciso ser mais óbvio que isto. No contexto do exemplo acima, alterar a segunda variável para <code>friend</code>, resolveria este problema e tornaria meu código mais descritivo.</p>

<h2>Não use abreviações</h2>


<p>Não use abreviações, à menos que elas sejam realmente óbvias. E quando eu digo óbvia estou dizendo que deve ser para qualquer um, mesmo alguém que nunca trabalhou em seu código. Não existe problema algum em usar nomes longos e descritivos. Veja por exemplo, o nome deste método:</p>

<pre class="textmate-source"><span class="source source_ruby source_ruby_rails"><span class="meta meta_function meta_function_method meta_function_method_without-arguments meta_function_method_without-arguments_ruby"><span class="keyword keyword_control keyword_control_def keyword_control_def_ruby">def</span> <span class="entity entity_name entity_name_function entity_name_function_ruby">thera_class_code_fmt</span></span>
<span class="comment comment_line comment_line_number-sign comment_line_number-sign_ruby">  <span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_ruby">#</span> devolve alguma coisa
</span><span class="keyword keyword_control keyword_control_ruby">end</span></span></pre>


<p>E então? O que este método faz? Para mim parece óbvio, mas você não tem obrigação de saber que &#8216;thera&#8217; é uma abreviação para therapeutic, assim como &#8216;fmt&#8217; é para formatted. Não seria melhor se este método se chamasse <code>formatted_therapeutic_class_code</code>?</p>

<p>No próprio Rails podemos encontrar alguns nomes longos e descritivos como <code>convert_number_column_value</code> e <code>class_name_of_active_record_descendant</code>. Em alguns casos nem precisamos olhar a documentação para entender como o método funciona.</p>

<h2>Prefixos não são necessários</h2>


<p>Prefixos como <code>str</code>, <code>int</code> e coisas do gênero não são necessários se eu der um nome descritivo à variável. Ao ver uma variável chamada <code>age</code> (idade) logo você deduz que ela deve ser do tipo numérica, assim não seria necessário dar a ela um nome estranho como <code>int_age</code>, ou algo parecido. Podemos dizer o mesmo de uma variável chamada <code>name</code> (nome) que obviamente deve ser um objeto do tipo string.</p>

<h2>Use os recursos da linguagem</h2>


<p>No Ruby também usamos alguns símbolos em nomes de métodos, como ‘?’ e ‘!’. Um símbolo de interrogação (?) no final no nome indica que aquele método deve retorna um booleano <code>true</code> ou <code>false</code>. O sinal de exclamação (!) informa que o método é <span style="text-decoration: line-through;">destrutivo</span> perigoso, o que pode significar duas coisas: no caso de algo dar errado ele devolverá uma exceção ao invés de um simples <code>false</code>, como nos métodos <code>save</code> e <code>save!</code> do Active Record ou que ele alterará a própria instância do objeto, ao invés de devolver uma nova instância, como nos métodos <code>merge</code> e <code>merge!</code>, por exemplo.</p>

<h2>Código bilingue?</h2>


<p>Embora não exista uma regra escrita para isto, também sou contra nomear variáveis, métodos ou classe em português. Acho que como todo o código já está em inglês, graças as palavras chaves do Ruby, devemos manter absolutamente tudo em inglês também. Isto não é tão difícil assim, já que você pode fazer uso de tradutores e dicionários (online) para encontrar a melhor descrição para eles.</p>

<h2>Pense antes de escolher um nome</h2>


<p>Algumas vezes, escolher um bom nome pode parecer difícil, e isto pode acabar roubando um pouco do seu tempo. A dica é que você termine de codificar o seu método primeiro, e depois com o contexto formado em sua mente ficará mais fácil dar um nome descritivo para o método e para as variáveis usadas. Se mesmo assim você ficar na dúvida, inclua um comentário com um <code>TODO</code> no seu código, vá tomar um café e quando você voltar com certeza encontrará um bom nome.</p>

<p>Uma das grandes vantagens que encontramos no Ruby e no Rails é que em ambos é extremamente normal encontrar nomes descritivos e tão curtos quanto possível em classe, módulo, métodos e variáveis. POR FAVOR, NÃO ESTRAGUE ISTO.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2009/02/12/rails-23-active-record/">Rails 2.3: Active Record</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-02-12T00:00:00-02:00" pubdate data-updated="true">12 de Fevereiro de 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>O lançamento do Ruby on Rails 2.3 está muito próximo e eu ainda não comentei sobre algumas novidades por aqui. A idéia desta <a href="http://www.nomedojogo.com/category/rails-23/">série</a> não é apenas mostrar as novas funcionalidades, mas explicar e dar exemplos de como elas funcionam na prática, mas alguns dos novos recursos são muito simples e não exigem muitos detalhes. Vejamos alguns relacionados ao Active Record.</p>

<p>Os <em>callbacks</em> do Active Record receberam uma nova implementação que permite o uso combinado das opções <code>:if</code> e <code>:unless</code> no mesmo <em>callback</em>. Você também pode usar um <em>array</em> para definir múltiplas condições:</p>

<pre class="textmate-source"><span class="source source_ruby source_ruby_rails"><span class="support support_function support_function_activerecord support_function_activerecord_rails">before_save</span> <span class="constant constant_other constant_other_symbol constant_other_symbol_ruby"><span class="punctuation punctuation_definition punctuation_definition_constant punctuation_definition_constant_ruby">:</span>update_credit_rating</span><span class="punctuation punctuation_separator punctuation_separator_object punctuation_separator_object_ruby">,</span>
            <span class="constant constant_other constant_other_symbol constant_other_symbol_ruby"><span class="punctuation punctuation_definition punctuation_definition_constant punctuation_definition_constant_ruby">:</span>if</span> <span class="punctuation punctuation_separator punctuation_separator_key-value">=&gt;</span> <span class="constant constant_other constant_other_symbol constant_other_symbol_ruby"><span class="punctuation punctuation_definition punctuation_definition_constant punctuation_definition_constant_ruby">:</span>active</span><span class="punctuation punctuation_separator punctuation_separator_object punctuation_separator_object_ruby">,</span>
            <span class="constant constant_other constant_other_symbol constant_other_symbol_ruby"><span class="punctuation punctuation_definition punctuation_definition_constant punctuation_definition_constant_ruby">:</span>unless</span> <span class="punctuation punctuation_separator punctuation_separator_key-value">=&gt;</span> <span class="punctuation punctuation_section punctuation_section_array punctuation_section_array_ruby">[</span><span class="constant constant_other constant_other_symbol constant_other_symbol_ruby"><span class="punctuation punctuation_definition punctuation_definition_constant punctuation_definition_constant_ruby">:</span>admin</span><span class="punctuation punctuation_separator punctuation_separator_object punctuation_separator_object_ruby">,</span> <span class="constant constant_other constant_other_symbol constant_other_symbol_ruby"><span class="punctuation punctuation_definition punctuation_definition_constant punctuation_definition_constant_ruby">:</span>cash_only</span><span class="punctuation punctuation_section punctuation_section_array punctuation_section_array_ruby">]</span>
</span></pre>


<p>O método <code>find</code> também ganhou uma nova opção <code>:having</code> para filtrar registros agrupados:</p>

<pre class="textmate-source"><span class="source source_ruby source_ruby_rails"><span class="support support_class support_class_ruby">Developer</span><span class="punctuation punctuation_separator punctuation_separator_method punctuation_separator_method_ruby">.</span>find<span class="punctuation punctuation_section punctuation_section_function punctuation_section_function_ruby">(</span><span class="constant constant_other constant_other_symbol constant_other_symbol_ruby"><span class="punctuation punctuation_definition punctuation_definition_constant punctuation_definition_constant_ruby">:</span>all</span><span class="punctuation punctuation_separator punctuation_separator_object punctuation_separator_object_ruby">,</span>
               <span class="constant constant_other constant_other_symbol constant_other_symbol_ruby"><span class="punctuation punctuation_definition punctuation_definition_constant punctuation_definition_constant_ruby">:</span>group</span> <span class="punctuation punctuation_separator punctuation_separator_key-value">=&gt;</span> <span class="string string_quoted string_quoted_double string_quoted_double_ruby"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_ruby">"</span>salary<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_ruby">"</span></span><span class="punctuation punctuation_separator punctuation_separator_object punctuation_separator_object_ruby">,</span>
               <span class="constant constant_other constant_other_symbol constant_other_symbol_ruby"><span class="punctuation punctuation_definition punctuation_definition_constant punctuation_definition_constant_ruby">:</span>having</span> <span class="punctuation punctuation_separator punctuation_separator_key-value">=&gt;</span> <span class="string string_quoted string_quoted_double string_quoted_double_ruby"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_ruby">"</span>sum(salary) &gt;  10000<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_ruby">"</span></span><span class="punctuation punctuation_separator punctuation_separator_object punctuation_separator_object_ruby">,</span>
               <span class="constant constant_other constant_other_symbol constant_other_symbol_ruby"><span class="punctuation punctuation_definition punctuation_definition_constant punctuation_definition_constant_ruby">:</span>select</span> <span class="punctuation punctuation_separator punctuation_separator_key-value">=&gt;</span> <span class="string string_quoted string_quoted_double string_quoted_double_ruby"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_ruby">"</span>salary<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_ruby">"</span></span><span class="punctuation punctuation_section punctuation_section_function punctuation_section_function_ruby">)</span>
</span></pre>


<p>Outra funcionalidade importante que temos de volta é o uso de um <em>hash</em> <code>:conditions</code> em relacionamentos <code>has_many</code>. Isto já funcionava no Rails 2.1, parou de funcionar no Rails 2.2 e está de volta no Rails 2.3.</p>

<pre class="textmate-source"><span class="source source_ruby source_ruby_rails"><span class="support support_function support_function_activerecord support_function_activerecord_rails">has_many</span> <span class="constant constant_other constant_other_symbol constant_other_symbol_ruby"><span class="punctuation punctuation_definition punctuation_definition_constant punctuation_definition_constant_ruby">:</span>orders</span><span class="punctuation punctuation_separator punctuation_separator_object punctuation_separator_object_ruby">,</span> <span class="constant constant_other constant_other_symbol constant_other_symbol_ruby"><span class="punctuation punctuation_definition punctuation_definition_constant punctuation_definition_constant_ruby">:</span>conditions</span> <span class="punctuation punctuation_separator punctuation_separator_key-value">=&gt;</span> <span class="punctuation punctuation_section punctuation_section_scope punctuation_section_scope_ruby">{</span><span class="constant constant_other constant_other_symbol constant_other_symbol_ruby"><span class="punctuation punctuation_definition punctuation_definition_constant punctuation_definition_constant_ruby">:</span>status</span> <span class="punctuation punctuation_separator punctuation_separator_key-value">=&gt;</span> <span class="string string_quoted string_quoted_single string_quoted_single_ruby"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_ruby">'</span>confirmed<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_ruby">'</span></span><span class="punctuation punctuation_section punctuation_section_scope punctuation_section_scope_ruby">}</span></span></pre>


<hr /><em>Todos os exemplos dados aqui funcionarão somente no <strong>Ruby on Rails 2.3 ou superior</strong>. Você pode encontrar mais detalhes sobre esta e outras novidades acompanhando a série <a href="../category/rails-23/">Rails 2.3</a>.</em>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2009/02/11/faca-voce-mesmo-primeiro/">Faça você mesmo primeiro</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-02-11T00:00:00-02:00" pubdate data-updated="true">11 de Fevereiro de 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Você nunca deve contratar alguém para fazer alguma coisa sem se esforçar em fazê-la primeiro. Isto vai ensinar-lhe mais do que o necessário para que você possa entrevistar os candidatos, vai permitir que você entenda melhor a natureza do trabalho (preciso mesmo contratar ou podemos terceirizar?) e você saberá exatamente como um trabalho bem feito deve parecer. Isto também vai lhe permitir saber se o trabalho é grande o suficiente para contratar alguém por tempo integral ou se você mesmo poderia fazê-lo.</p>

<p>Jason não me contratou para ajudá-lo no programa Singlefile (extinto) antes de ter uma espécie de protótipo-mal-feito criado através de suas próprias competências em PHP. Eu não contratei Mark para fazer a administração do sistema sem antes perder um verão inteiro configurando um cluster. Jason não trouxe Sarah à bordo para manter o serviço de suporte antes dele mesmo ter tentado fazer isto por alguns anos.</p>

<p>Os benefícios de tentar fazer você mesmo o trabalho antes de contratar alguém não estão somente na hora de realizar uma contratação. Você conseguirá gerenciar muito melhor o trabalho se você em algum momento já o realizou, do que quando você está totalmente no escuro sobre o que precisa ser feito. Você terá empatia quando as coisas não ocorrerem da forma como você esperava e a culpa não for exatamente do funcionário - e também terá voz ativa quando for.</p>

<p><img class="center" src="http://old.nomedojogo.com/wp-content/uploads/2009/02/2914363493_73a21ed86a.jpg"></p>

<p>Não deixe que nomes compridos o assuste. O que um diretor de desenvolvedor empresarial faz? Descubra fazendo você mesmo. Chame algumas pessoas, tente fazer alguns negócios. Você acha que precisa de alguém para realizar testes de usabilidade em seu projeto? Tente fazer você mesmo uma sessão com seus amigos. Não, ele não sairá perfeito. Mas tudo bem. O que você está perdendo nesta execução inicial lhe será reembolsado várias vezes pelos benefícios descritos acima.</p>

<hr /><em>Este texto é uma tradução do artigo escrito por <strong>David Heinemeier Hansson</strong> para o blog <a href="http://blogcabin.37signals.com/svn/">Signal vs. Noise</a>, originalmente em <a href="http://www.37signals.com/svn/posts/1296-do-it-yourself-first">inglês</a>.</em>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2009/02/10/remarkable-now-supports-all-activerecord-validations/">Remarkable now supports all ActiveRecord validations</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-02-10T00:00:00-02:00" pubdate data-updated="true">10 de Fevereiro de 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Good times! It has been just one week since I announced <a href="http://www.diegocarrion.com/">Diego Carrion</a> and <a href="http://josevalim.blogspot.com/">José Valim</a> as members of the <a href="http://github.com/carlosbrando/remarkable/tree/master">Remarkable</a> core team and we already put some effort into making a new shiny release! We are going to cover what&#8217;s new on this <a href="http://github.com/carlosbrando/remarkable/tree/master">Remarkable</a> version, step by step.</p>

<h2>1. All ActiveRecord validations are supported with all options</h2>


<p>In other words, you can write your spec validation macros the same way as you do in <code>ActiveRecord</code>, without consulting the documentation, without worrying if any validation is supported or not, without checking which options are allowed or not. Check it out:</p>

<pre class="textmate-source"><span class="source source_ruby source_ruby_rspec"><span class="meta meta_rspec meta_rspec_behaviour"><span class="keyword keyword_other keyword_other_rspec keyword_other_rspec_behaviour">describe</span> <span class="variable variable_other variable_other_constant variable_other_constant_ruby">User</span> <span class="keyword keyword_control keyword_control_ruby keyword_control_ruby_start-block">do</span></span>
<span class="meta meta_rspec meta_rspec_pending">  <span class="keyword keyword_other keyword_other_rspec keyword_other_rspec_pending">it</span> <span class="string string_ruby">{ should validate_uniqueness_of(:email) }</span></span>
<span class="meta meta_rspec meta_rspec_pending">  <span class="keyword keyword_other keyword_other_rspec keyword_other_rspec_pending">it</span> <span class="string string_ruby">{ should validate_presence_of(:email, :password) }</span></span>
<span class="meta meta_rspec meta_rspec_pending">  <span class="keyword keyword_other keyword_other_rspec keyword_other_rspec_pending">it</span> <span class="string string_ruby">{ should validate_confirmation_of( :email, :password) }</span></span>

<span class="meta meta_rspec meta_rspec_pending">  <span class="keyword keyword_other keyword_other_rspec keyword_other_rspec_pending">it</span> <span class="string string_ruby">{ should validate_acceptance_of(:terms) }</span></span>
<span class="meta meta_rspec meta_rspec_pending">  <span class="keyword keyword_other keyword_other_rspec keyword_other_rspec_pending">it</span> <span class="string string_ruby">{ should validate_inclusion_of(:gender, %w(m f), :message =&gt; 'whoa! what are you then?') }</span></span>
<span class="meta meta_rspec meta_rspec_pending">  <span class="keyword keyword_other keyword_other_rspec keyword_other_rspec_pending">it</span> <span class="string string_ruby">{ should validate_length_of(:password, :within =&gt; 6..20) }</span></span>
<span class="meta meta_rspec meta_rspec_pending">  <span class="keyword keyword_other keyword_other_rspec keyword_other_rspec_pending">it</span> <span class="string string_ruby">{ should validate_numericality_of(:age, :greater_than_or_equal_to =&gt; 18, :allow_nil =&gt; false) }</span></span>

<span class="meta meta_rspec meta_rspec_pending">  <span class="keyword keyword_other keyword_other_rspec keyword_other_rspec_pending">it</span> <span class="string string_ruby">{ should allow_mass_assignment_of(:password, :email) }</span></span>
<span class="meta meta_rspec meta_rspec_pending">  <span class="keyword keyword_other keyword_other_rspec keyword_other_rspec_pending">it</span> <span class="string string_ruby">{ should not_allow_mass_assignment_of(:salt, :hashed_password) }</span></span>
<span class="keyword keyword_control keyword_control_ruby">end</span></span></pre>


<p>Or if you prefer:</p>

<pre class="textmate-source"><span class="source source_ruby source_ruby_rspec"><span class="meta meta_rspec meta_rspec_behaviour"><span class="keyword keyword_other keyword_other_rspec keyword_other_rspec_behaviour">describe</span> <span class="variable variable_other variable_other_constant variable_other_constant_ruby">User</span> <span class="keyword keyword_control keyword_control_ruby keyword_control_ruby_start-block">do</span></span>
  should_validate_uniqueness_of <span class="constant constant_other constant_other_symbol constant_other_symbol_ruby"><span class="punctuation punctuation_definition punctuation_definition_constant punctuation_definition_constant_ruby">:</span>email</span>
  should_validate_presence_of <span class="constant constant_other constant_other_symbol constant_other_symbol_ruby"><span class="punctuation punctuation_definition punctuation_definition_constant punctuation_definition_constant_ruby">:</span>email</span><span class="punctuation punctuation_separator punctuation_separator_object punctuation_separator_object_ruby">,</span> <span class="constant constant_other constant_other_symbol constant_other_symbol_ruby"><span class="punctuation punctuation_definition punctuation_definition_constant punctuation_definition_constant_ruby">:</span>password</span>
  should_validate_confirmation_of <span class="constant constant_other constant_other_symbol constant_other_symbol_ruby"><span class="punctuation punctuation_definition punctuation_definition_constant punctuation_definition_constant_ruby">:</span>email</span><span class="punctuation punctuation_separator punctuation_separator_object punctuation_separator_object_ruby">,</span> <span class="constant constant_other constant_other_symbol constant_other_symbol_ruby"><span class="punctuation punctuation_definition punctuation_definition_constant punctuation_definition_constant_ruby">:</span>password</span>

  should_validate_acceptance_of <span class="constant constant_other constant_other_symbol constant_other_symbol_ruby"><span class="punctuation punctuation_definition punctuation_definition_constant punctuation_definition_constant_ruby">:</span>terms</span>
  should_validate_inclusion_of <span class="constant constant_other constant_other_symbol constant_other_symbol_ruby"><span class="punctuation punctuation_definition punctuation_definition_constant punctuation_definition_constant_ruby">:</span>gender</span><span class="punctuation punctuation_separator punctuation_separator_object punctuation_separator_object_ruby">,</span> <span class="string string_quoted string_quoted_other string_quoted_other_literal string_quoted_other_literal_lower string_quoted_other_literal_lower_ruby"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_ruby">%w(</span>m f<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_ruby">)</span></span><span class="punctuation punctuation_separator punctuation_separator_object punctuation_separator_object_ruby">,</span> <span class="constant constant_other constant_other_symbol constant_other_symbol_ruby"><span class="punctuation punctuation_definition punctuation_definition_constant punctuation_definition_constant_ruby">:</span>message</span> <span class="punctuation punctuation_separator punctuation_separator_key-value">=&gt;</span> <span class="string string_quoted string_quoted_single string_quoted_single_ruby"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_ruby">'</span>whoa! what are you then?<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_ruby">'</span></span>
  should_validate_length_of <span class="constant constant_other constant_other_symbol constant_other_symbol_ruby"><span class="punctuation punctuation_definition punctuation_definition_constant punctuation_definition_constant_ruby">:</span>password</span><span class="punctuation punctuation_separator punctuation_separator_object punctuation_separator_object_ruby">,</span> <span class="constant constant_other constant_other_symbol constant_other_symbol_ruby"><span class="punctuation punctuation_definition punctuation_definition_constant punctuation_definition_constant_ruby">:</span>within</span> <span class="punctuation punctuation_separator punctuation_separator_key-value">=&gt;</span> <span class="constant constant_numeric constant_numeric_ruby">6</span><span class="punctuation punctuation_separator punctuation_separator_method punctuation_separator_method_ruby">..</span><span class="constant constant_numeric constant_numeric_ruby">20</span>
  should_validate_numericality_of <span class="constant constant_other constant_other_symbol constant_other_symbol_ruby"><span class="punctuation punctuation_definition punctuation_definition_constant punctuation_definition_constant_ruby">:</span>age</span><span class="punctuation punctuation_separator punctuation_separator_object punctuation_separator_object_ruby">,</span> <span class="constant constant_other constant_other_symbol constant_other_symbol_ruby"><span class="punctuation punctuation_definition punctuation_definition_constant punctuation_definition_constant_ruby">:</span>greater_than_or_equal_to</span> <span class="punctuation punctuation_separator punctuation_separator_key-value">=&gt;</span> <span class="constant constant_numeric constant_numeric_ruby">18</span><span class="punctuation punctuation_separator punctuation_separator_object punctuation_separator_object_ruby">,</span> <span class="constant constant_other constant_other_symbol constant_other_symbol_ruby"><span class="punctuation punctuation_definition punctuation_definition_constant punctuation_definition_constant_ruby">:</span>allow_nil</span> <span class="punctuation punctuation_separator punctuation_separator_key-value">=&gt;</span> <span class="constant constant_language constant_language_ruby">false</span>

  should_allow_mass_assignment_of <span class="constant constant_other constant_other_symbol constant_other_symbol_ruby"><span class="punctuation punctuation_definition punctuation_definition_constant punctuation_definition_constant_ruby">:</span>password</span><span class="punctuation punctuation_separator punctuation_separator_object punctuation_separator_object_ruby">,</span> <span class="constant constant_other constant_other_symbol constant_other_symbol_ruby"><span class="punctuation punctuation_definition punctuation_definition_constant punctuation_definition_constant_ruby">:</span>email</span>
  should_not_allow_mass_assignment_of <span class="constant constant_other constant_other_symbol constant_other_symbol_ruby"><span class="punctuation punctuation_definition punctuation_definition_constant punctuation_definition_constant_ruby">:</span>salt</span><span class="punctuation punctuation_separator punctuation_separator_object punctuation_separator_object_ruby">,</span> <span class="constant constant_other constant_other_symbol constant_other_symbol_ruby"><span class="punctuation punctuation_definition punctuation_definition_constant punctuation_definition_constant_ruby">:</span>hashed_password</span>
<span class="keyword keyword_control keyword_control_ruby">end</span></span></pre>


<p>We <a href="http://wiki.github.com/carlosbrando/remarkable/active-record-macros">updated the wiki</a> and it&#8217;s already reflecting the new macros. But you might ask, what happened with the older ones? The older ones are going to be deprecated and you will see a message while running the tests.</p>

<p>What you might have noticed above is that <code>should_protect_attributes</code> now became <code>should_not_allow_mass_assignment_of</code>. This one was based on Shoulda last changes, so who are porting tests from Shoulda gets everything compatible.</p>

<h2>2. Pending macros</h2>


<p>We are not just bringing macros to Rspec, we are bringng Rspec to macros! So let&#8217;s suppose you are doing some code refactoring and you know some tests will fail while you clean the house, what do you do then?</p>

<p>In Rspec, you can do:</p>

<pre class="textmate-source"><span class="source source_ruby source_ruby_rspec">xit <span class="punctuation punctuation_section punctuation_section_scope punctuation_section_scope_ruby">{</span><span class="meta meta_syntax meta_syntax_ruby meta_syntax_ruby_start-block"> </span>should validate_numericality_of<span class="punctuation punctuation_section punctuation_section_function punctuation_section_function_ruby">(</span><span class="constant constant_other constant_other_symbol constant_other_symbol_ruby"><span class="punctuation punctuation_definition punctuation_definition_constant punctuation_definition_constant_ruby">:</span>age</span><span class="punctuation punctuation_section punctuation_section_function punctuation_section_function_ruby">)</span> <span class="punctuation punctuation_section punctuation_section_scope punctuation_section_scope_ruby">}</span></span></pre>


<p>Well, now you can do just the same with macros:</p>

<pre class="textmate-source"><span class="source source_ruby source_ruby_rails">xshould_validate_numericality_of <span class="constant constant_other constant_other_symbol constant_other_symbol_ruby"><span class="punctuation punctuation_definition punctuation_definition_constant punctuation_definition_constant_ruby">:</span>age</span></span></pre>


<p>And it&#8217;s even better because it shows you a nice message:</p>

<pre class="textmate-source"><span class="source source_shell"><span class="meta meta_scope meta_scope_group meta_scope_group_shell"><span class="meta meta_scope meta_scope_group meta_scope_group_shell"><span class="meta meta_scope meta_scope_group meta_scope_group_shell"><span class="meta meta_scope meta_scope_group meta_scope_group_shell"><span class="meta meta_scope meta_scope_group meta_scope_group_shell"><span class="meta meta_scope meta_scope_group meta_scope_group_shell"><span class="meta meta_scope meta_scope_group meta_scope_group_shell"><span class="meta meta_scope meta_scope_group meta_scope_group_shell"><span class="meta meta_scope meta_scope_group meta_scope_group_shell"><span class="meta meta_scope meta_scope_group meta_scope_group_shell">Example disabled: should validate numericality of age</span></span></span></span></span></span></span></span></span></span></span></pre>


<p>Yeah!</p>

<h2>3. Full I18n support</h2>


<p>You know how validations macros (as <code>validate_presence_of</code>) work? Let&#8217;s talk about it a little bit.</p>

<p>When you say that we should validate presence of e-mail, we set the e-mail to nil and save the object. Then we search in all error messages in e-mail, if it has a &#8220;can&#8217;t be blank&#8221; message, your validation is working properly and then the test passes, otherwise, the test fails. The problem is, if you change the error message in your application and do not change on the macro, we will never be able to find the message &#8220;can&#8217;t be blank&#8221; and then the tests will always pass.</p>

<p>This is valid for almost rspec matchers, not only on Remarkable. But what&#8217;s new is, if you change the message using the I18n YAML files, we will find the message properly and you don&#8217;t have to pass <code>:message</code> in your macros. This is new and we are currently the only one doing this.</p>

<p>But remember, if ever you set the message directly in your models like this:</p>

<pre class="textmate-source"><span class="source source_ruby source_ruby_rspec">validates_inclusion_of <span class="constant constant_other constant_other_symbol constant_other_symbol_ruby"><span class="punctuation punctuation_definition punctuation_definition_constant punctuation_definition_constant_ruby">:</span>gender</span><span class="punctuation punctuation_separator punctuation_separator_object punctuation_separator_object_ruby">,</span> <span class="string string_quoted string_quoted_other string_quoted_other_literal string_quoted_other_literal_lower string_quoted_other_literal_lower_ruby"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_ruby">%w(</span>m f<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_ruby">)</span></span><span class="punctuation punctuation_separator punctuation_separator_object punctuation_separator_object_ruby">,</span> <span class="constant constant_other constant_other_symbol constant_other_symbol_ruby"><span class="punctuation punctuation_definition punctuation_definition_constant punctuation_definition_constant_ruby">:</span>message</span> <span class="punctuation punctuation_separator punctuation_separator_key-value">=&gt;</span> <span class="string string_quoted string_quoted_single string_quoted_single_ruby"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_ruby">'</span>whoa! what are you then?<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_ruby">'</span></span></span></pre>


<p>Don&#8217;t forget to do the same in your macros:</p>

<pre class="textmate-source"><span class="source source_ruby source_ruby_rspec">should_validate_inclusion_of <span class="constant constant_other constant_other_symbol constant_other_symbol_ruby"><span class="punctuation punctuation_definition punctuation_definition_constant punctuation_definition_constant_ruby">:</span>gender</span><span class="punctuation punctuation_separator punctuation_separator_object punctuation_separator_object_ruby">,</span> <span class="string string_quoted string_quoted_other string_quoted_other_literal string_quoted_other_literal_lower string_quoted_other_literal_lower_ruby"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_ruby">%w(</span>m f<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_ruby">)</span></span><span class="punctuation punctuation_separator punctuation_separator_object punctuation_separator_object_ruby">,</span> <span class="constant constant_other constant_other_symbol constant_other_symbol_ruby"><span class="punctuation punctuation_definition punctuation_definition_constant punctuation_definition_constant_ruby">:</span>message</span> <span class="punctuation punctuation_separator punctuation_separator_key-value">=&gt;</span> <span class="string string_quoted string_quoted_single string_quoted_single_ruby"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_ruby">'</span>whoa! what are you then?<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_ruby">'</span></span></span></pre>


<p>Deal?</p>

<h2>Conclusion</h2>


<p><a href="http://github.com/carlosbrando/remarkable/tree/master">Remarkable is available on GitHub</a> and to install it, just do on your console:</p>

<pre class="textmate-source"><span class="source source_shell">gem sources -a http://gems.github.com/
sudo gem install <span class="string string_quoted string_quoted_double string_quoted_double_shell"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_shell">"</span>carlosbrando-remarkable<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_shell">"</span></span></span></pre>


<p>And then on your <code>RAILS_ROOT/config/environment.rb</code>:</p>

<pre class="textmate-source"><span class="source source_ruby source_ruby_rails">config<span class="punctuation punctuation_separator punctuation_separator_method punctuation_separator_method_ruby">.</span>gem <span class="string string_quoted string_quoted_double string_quoted_double_ruby"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_ruby">"</span>carlosbrando-remarkable<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_ruby">"</span></span><span class="punctuation punctuation_separator punctuation_separator_object punctuation_separator_object_ruby">,</span> <span class="constant constant_other constant_other_symbol constant_other_symbol_ruby"><span class="punctuation punctuation_definition punctuation_definition_constant punctuation_definition_constant_ruby">:</span>lib</span> <span class="punctuation punctuation_separator punctuation_separator_key-value">=&gt;</span> <span class="string string_quoted string_quoted_double string_quoted_double_ruby"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_ruby">"</span>remarkable<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_ruby">"</span></span><span class="punctuation punctuation_separator punctuation_separator_object punctuation_separator_object_ruby">,</span> <span class="constant constant_other constant_other_symbol constant_other_symbol_ruby"><span class="punctuation punctuation_definition punctuation_definition_constant punctuation_definition_constant_ruby">:</span>source</span> <span class="punctuation punctuation_separator punctuation_separator_key-value">=&gt;</span> <span class="string string_quoted string_quoted_double string_quoted_double_ruby"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_ruby">"</span>http://gems.github.com/<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_ruby">"</span></span></span></pre>


<h2>Any doubts? Any bug?</h2>


<p>We want to hear you! So you can use the <a href="http://groups.google.com/group/remarkable-core">Remarkable google group</a>, our <a href="http://carlosbrando.lighthouseapp.com/projects/19775-remarkable/">bug tracking system</a>, Github comments, whatever suits you better!</p>

<p>See you there!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2009/02/09/evento-ruby-e-rails-no-mundo-real/">Evento: Ruby e Rails no Mundo Real</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-02-09T00:00:00-02:00" pubdate data-updated="true"> 9 de Fevereiro de 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Mais um evento sobre Ruby on Rails em São Paulo, desta vez promovido pelo grupo <a href="http://www.guru-sp.com/index.php/P%C3%A1gina_principal">Guru-SP</a> (Grupo de Usuários Ruby de São Paulo).</p>

<p>A idéia do evento é exibir palestras práticas com temas que tratarão de assuntos relacionados ao dia a dia de profissionais Rails, como controle de versão, testes, treinamentos, servidores de aplicação e mercado de trabalho (brasileiro e exterior).</p>

<p>O evento já está confirmado para o dia 4 de abril de 2009 e será realizado no Century Flat Paulista que fica na <a href="http://www.temporealeventos.com.br/?area=130&amp;tipo=1&amp;id=2471">Rua Teixeira da Silva, 647</a> no Paraíso.</p>

<p>Veja abaixo a relação de palestras, palestrantes e horários:</p>

<p style="padding-left: 30px;"><strong>8h00:</strong> Boas Vindas, Credenciamento e Retirada do Material do Congressista</p>


<p style="padding-left: 30px;"><strong>9h15:</strong> Criando um Instant Messenger usando Rails por Vinícius Baggio Fuentes</p>


<p style="padding-left: 30px;"><strong>10h30:</strong> Ruby, Rails e empreendedorismo mini-palestra por Hugo Lima Borges</p>


<p style="padding-left: 30px;"><strong>11h00:</strong> Integrando Ruby e Java para facilitar a vida por Marcelo Castellani</p>


<p style="padding-left: 30px;"><strong>13h00:</strong> Outsorcing, ou como trabalhar para empresas gringas por Rodrigo Franco</p>


<p style="padding-left: 30px;"><strong>14h00:</strong> GlassFish on Rails: Escalabilidade e Confiabilidade por Mauricio Leal</p>


<p style="padding-left: 30px;"><strong>15h00:</strong> Só imaturos não testam por Carlos Brando</p>


<p style="padding-left: 30px;"><strong>16h00:</strong> O que é e como funciona o RubyLearning mini-palestra por Willian Molinari</p>


<p style="padding-left: 30px;"><strong>16h15:</strong> Utilizando Gitorious nos seus projetos por Fabio Akita</p>


<p>Para os que se cadastrarem até o dia 6 de março a inscrição para o evento sai por 49 reais, o que representa custo muito pequeno, levando-se em conta o nível das palestras e palestrantes. Após esta data, o valor é de 69 reais.</p>

<p>Para mais informações acesse a <a href="http://www.temporealeventos.com.br/?area=130">página oficial</a> do evento.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2009/02/06/rails-way-variaveis-de-instancia-controllers-e-views/">Rails Way: Variáveis de Instância, Controllers e Views</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-02-06T00:00:00-02:00" pubdate data-updated="true"> 6 de Fevereiro de 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Mais uma sexta-feira e mais um artigo da série <a href="http://www.nomedojogo.com/category/rails-way/">Rails Way</a>, onde vou pouco a pouco mostrando a forma como os Rubistas mais experientes costumam programar no Ruby on Rails.</p>

<p>Programadores iniciantes rapidamente ficam fascinados com o Ruby e principalmente com o Rails, e por serem uma linguagem e framework com uma curva de aprendizado muito curta é comum que ao terminarem seu primeiro projeto em Rails, percam um pouco o interesse em entender como determinadas coisas funcionam, assimilando tudo que o Rails faz como pura mágica.</p>

<p>Isto é extremamente prejudicial ao programador iniciante e pode levá-lo a se tornar um programador “experiente” com pouco ou nenhum conhecimento real sobre o funcionamento interno da sua ferramenta de trabalho.</p>

<p>A ideia desta série de artigos é expor algumas boas práticas de desenvolvimento ao mesmo tempo em que tento explicar de uma forma simples como as engrenagens funcionam. Por exemplo, já se perguntou como um controller e uma view compartilham as mesmas variáveis de instância?</p>

<p>Por definição uma variável de instância só existe dentro de uma única instância de um objeto. Mas quando estamos falando de controllers e view, estamos falando de dois objetos diferentes que compartilham as mesmas variáveis.</p>

<pre class="textmate-source"><span class="source source_ruby source_ruby_rails"><span class="comment comment_line comment_line_number-sign comment_line_number-sign_ruby"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_ruby">#</span> books_controller.rb
</span><span class="meta meta_rails meta_rails_controller"><span class="meta meta_class meta_class_ruby"><span class="keyword keyword_control keyword_control_class keyword_control_class_ruby">class</span> <span class="entity entity_name entity_name_type entity_name_type_class entity_name_type_class_ruby">BooksController<span class="entity entity_other entity_other_inherited-class entity_other_inherited-class_ruby"> <span class="punctuation punctuation_separator punctuation_separator_inheritance punctuation_separator_inheritance_ruby">&lt;</span> ApplicationController</span></span></span>
  <span class="meta meta_function meta_function_method meta_function_method_without-arguments meta_function_method_without-arguments_ruby"><span class="keyword keyword_control keyword_control_def keyword_control_def_ruby">def</span> <span class="entity entity_name entity_name_function entity_name_function_ruby">index</span></span>
    <span class="variable variable_other variable_other_readwrite variable_other_readwrite_instance variable_other_readwrite_instance_ruby"><span class="punctuation punctuation_definition punctuation_definition_variable punctuation_definition_variable_ruby">@</span>books</span> <span class="keyword keyword_operator keyword_operator_assignment keyword_operator_assignment_ruby">=</span> <span class="support support_class support_class_ruby">Book</span><span class="punctuation punctuation_separator punctuation_separator_method punctuation_separator_method_ruby">.</span>find<span class="punctuation punctuation_section punctuation_section_function punctuation_section_function_ruby">(</span><span class="constant constant_other constant_other_symbol constant_other_symbol_ruby"><span class="punctuation punctuation_definition punctuation_definition_constant punctuation_definition_constant_ruby">:</span>all</span><span class="punctuation punctuation_section punctuation_section_function punctuation_section_function_ruby">)</span>
  <span class="keyword keyword_control keyword_control_ruby">end</span>
</span><span class="keyword keyword_control keyword_control_ruby">end</span>
</span></pre>




<pre class="textmate-source"><span class="text text_html text_html_ruby"><span class="comment comment_block comment_block_html"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_html">&lt;!--</span> index.html.erb <span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_html">--&gt;</span></span>
<span class="source source_ruby source_ruby_rails source_ruby_rails_embedded source_ruby_rails_embedded_html"><span class="punctuation punctuation_section punctuation_section_embedded punctuation_section_embedded_ruby">&lt;%</span> <span class="keyword keyword_control keyword_control_ruby">for</span> book <span class="keyword keyword_control keyword_control_ruby">in</span> <span class="variable variable_other variable_other_readwrite variable_other_readwrite_instance variable_other_readwrite_instance_ruby"><span class="punctuation punctuation_definition punctuation_definition_variable punctuation_definition_variable_ruby">@</span>books</span> <span class="punctuation punctuation_section punctuation_section_embedded punctuation_section_embedded_ruby">%&gt;</span></span>
   <span class="source source_ruby source_ruby_rails source_ruby_rails_embedded source_ruby_rails_embedded_html"><span class="punctuation punctuation_section punctuation_section_embedded punctuation_section_embedded_ruby">&lt;%=</span> book<span class="punctuation punctuation_separator punctuation_separator_method punctuation_separator_method_ruby">.</span>title <span class="punctuation punctuation_section punctuation_section_embedded punctuation_section_embedded_ruby">%&gt;</span></span>
<span class="source source_ruby source_ruby_rails source_ruby_rails_embedded source_ruby_rails_embedded_html"><span class="punctuation punctuation_section punctuation_section_embedded punctuation_section_embedded_ruby">&lt;%</span> <span class="keyword keyword_control keyword_control_ruby">end</span> <span class="punctuation punctuation_section punctuation_section_embedded punctuation_section_embedded_ruby">%&gt;</span></span>
</span></pre>


<p>Nos exemplos acima estou definindo uma variável de instância <code>@books</code> dentro do controller, e eu simplesmente assumo que a variável também estará disponível na view.</p>

<p>Note que meu controller é uma extensão da classe <code>ApplicationController</code> que por sua vez é uma extensão da classe <code>ActionController::Base</code> e por isto é uma instância desta classe. Por outro lado a minha view é uma instância da classe <code>ActionView::Base</code>. Ou seja, meu controller é uma instância de um objeto enquanto minha view é uma instância de um outro objeto totalmente diferente.</p>

<p>Então como é possível compartilhar uma variável de instância quando temos duas instância de objetos diferentes? Será mágica? Não, a resposta é mais simples do que você imagina.</p>

<p>O Rails acrescenta à classe <code>Object</code> um método chamado <code>copy_instance_variables_from</code> que faz exatamente o que o nome diz, copia variáveis de instância de uma classe para outro. Você pode até mesmo brincar um pouco com este método no console. Abra o terminal e após digitar o comando <code>irb</code>, copie e cole o código abaixo e veja o resultado:</p>

<pre class="textmate-source"><span class="source source_ruby"><span class="meta meta_require meta_require_ruby"><span class="keyword keyword_other keyword_other_special-method keyword_other_special-method_ruby">require</span> <span class="string string_quoted string_quoted_single string_quoted_single_ruby"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_ruby">'</span>rubygems<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_ruby">'</span></span></span>
<span class="meta meta_require meta_require_ruby"><span class="keyword keyword_other keyword_other_special-method keyword_other_special-method_ruby">require</span> <span class="string string_quoted string_quoted_single string_quoted_single_ruby"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_ruby">'</span>active_support<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_ruby">'</span></span></span>


<span class="meta meta_class meta_class_ruby"><span class="keyword keyword_control keyword_control_class keyword_control_class_ruby">class</span> <span class="entity entity_name entity_name_type entity_name_type_class entity_name_type_class_ruby">A</span></span>
  <span class="keyword keyword_other keyword_other_special-method keyword_other_special-method_ruby">attr_reader</span> <span class="constant constant_other constant_other_symbol constant_other_symbol_ruby"><span class="punctuation punctuation_definition punctuation_definition_constant punctuation_definition_constant_ruby">:</span>x</span><span class="punctuation punctuation_separator punctuation_separator_object punctuation_separator_object_ruby">,</span> <span class="constant constant_other constant_other_symbol constant_other_symbol_ruby"><span class="punctuation punctuation_definition punctuation_definition_constant punctuation_definition_constant_ruby">:</span>y</span>
<span class="keyword keyword_control keyword_control_ruby">end</span>

<span class="meta meta_class meta_class_ruby"><span class="keyword keyword_control keyword_control_class keyword_control_class_ruby">class</span> <span class="entity entity_name entity_name_type entity_name_type_class entity_name_type_class_ruby">B</span></span>
  <span class="meta meta_function meta_function_method meta_function_method_without-arguments meta_function_method_without-arguments_ruby"><span class="keyword keyword_control keyword_control_def keyword_control_def_ruby">def</span> <span class="entity entity_name entity_name_function entity_name_function_ruby">initialize</span></span>
    <span class="variable variable_other variable_other_readwrite variable_other_readwrite_instance variable_other_readwrite_instance_ruby"><span class="punctuation punctuation_definition punctuation_definition_variable punctuation_definition_variable_ruby">@</span>x</span> <span class="keyword keyword_operator keyword_operator_assignment keyword_operator_assignment_ruby">=</span> <span class="string string_quoted string_quoted_single string_quoted_single_ruby"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_ruby">'</span>valor copiado da classe B<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_ruby">'</span></span>
    <span class="variable variable_other variable_other_readwrite variable_other_readwrite_instance variable_other_readwrite_instance_ruby"><span class="punctuation punctuation_definition punctuation_definition_variable punctuation_definition_variable_ruby">@</span>y</span> <span class="keyword keyword_operator keyword_operator_assignment keyword_operator_assignment_ruby">=</span> <span class="constant constant_numeric constant_numeric_ruby">11</span>
  <span class="keyword keyword_control keyword_control_ruby">end</span>
<span class="keyword keyword_control keyword_control_ruby">end</span>


a <span class="keyword keyword_operator keyword_operator_assignment keyword_operator_assignment_ruby">=</span> <span class="support support_class support_class_ruby">A</span><span class="punctuation punctuation_separator punctuation_separator_method punctuation_separator_method_ruby">.</span><span class="keyword keyword_other keyword_other_special-method keyword_other_special-method_ruby">new</span>
b <span class="keyword keyword_operator keyword_operator_assignment keyword_operator_assignment_ruby">=</span> <span class="support support_class support_class_ruby">B</span><span class="punctuation punctuation_separator punctuation_separator_method punctuation_separator_method_ruby">.</span><span class="keyword keyword_other keyword_other_special-method keyword_other_special-method_ruby">new</span>

puts a<span class="punctuation punctuation_separator punctuation_separator_method punctuation_separator_method_ruby">.</span>x <span class="comment comment_line comment_line_number-sign comment_line_number-sign_ruby"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_ruby">#</span> =&gt; nil
</span>puts a<span class="punctuation punctuation_separator punctuation_separator_method punctuation_separator_method_ruby">.</span>y <span class="comment comment_line comment_line_number-sign comment_line_number-sign_ruby"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_ruby">#</span> =&gt; nil
</span>
a<span class="punctuation punctuation_separator punctuation_separator_method punctuation_separator_method_ruby">.</span>copy_instance_variables_from<span class="punctuation punctuation_section punctuation_section_function punctuation_section_function_ruby">(</span>b<span class="punctuation punctuation_section punctuation_section_function punctuation_section_function_ruby">)</span>

puts a<span class="punctuation punctuation_separator punctuation_separator_method punctuation_separator_method_ruby">.</span>x <span class="comment comment_line comment_line_number-sign comment_line_number-sign_ruby"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_ruby">#</span> =&gt; "valor copiado da classe B"
</span>puts a<span class="punctuation punctuation_separator punctuation_separator_method punctuation_separator_method_ruby">.</span>y <span class="comment comment_line comment_line_number-sign comment_line_number-sign_ruby"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_ruby">#</span> =&gt; 11</span></span></pre>


<p>Acabamos de copiar todas as variáveis de instância de um objeto para outro. É exatamente assim que acontece com controllers e views.</p>

<p>O que acontece por debaixo dos panos é que quando o método <code>render</code> do controller é executado, primeiro ele copia todas as variáveis de instância que você criou para dentro de apenas uma variável chamada <code>@assigns</code>, que funciona como um <code>Hash</code>. E ao criar uma uma nova view, ele faz uma copia desta variável (<code>@assigns</code> com todas as suas variáveis dentro) para o novo objeto. Simples não?</p>

<h2>O inferno das variáveis</h2>


<p>O que tenho visto muitas vezes é que alguns programadores tem abusado desta facilidade que o Rails oferece, criando inúmeras variáveis de instância no controller para recuperar todo tipo de informação na view.</p>

<p>Manter muitas variáveis complica o gerenciamento do código, e em alguns casos acabamos até mesmo fazendo chamadas repetidas à associações de um modelo sem se dar conta disso, causando um problema de performance em nosso projeto.</p>

<p>O ideal é que você compartilhe apenas uma variável de instância entre seu controller e sua view. Desta forma todas as chamadas para associações serão realizadas &#8220;on demand&#8221; evitando o consumo indevido de recursos e tornando a manutenção do código mais simples.</p>

<p><img class="center" src="http://old.nomedojogo.com/wp-content/uploads/2009/02/97493713_c72ee9a7bd.jpg"></p>

<p>Isto não quer dizer que você não possa compartilhar outras variáveis quando necessário. Mas é importante que você analise a real necessidade de se fazer isto. Por exemplo, é mais prático criar um helper <code>current_user</code> para recuperar o usuário atual do que sempre armazená-lo em uma variável <code>@current_user</code>.</p>

<p>Se no primeiro exemplo você precisasse recuperar também todos os livros relacionados ao livro atual, talvez parecesse razoável criar uma segunda variável <code>@related_books</code> contendo estes livros. Mas se você colocar em prática a <a href="http://www.nomedojogo.com/2009/01/30/rails-way-1-modelos-gordos-e-controladores-magros/">primeira dica</a> desta série e acrescentar o método <code>related_books</code> ao modelo <code>Book</code>, você poderá usar <code>@book.related_books</code> na sua view. Evitando a criação desnecessária de mais uma variável e deixando seu código mais limpo e organizado.</p>

<p>Usem de bom senso.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2009/02/05/rails-23-nested-transactions/">Rails 2.3: Nested Transactions</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-02-05T00:00:00-02:00" pubdate data-updated="true"> 5 de Fevereiro de 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Outro recurso que também foi muito solicitado e estará disponível com a versão 2.3 do Rails é uma melhoria nas nested transactions (transações aninhadas).</p>

<p>Atualmente no Rails já podemos aninhar transações, ou em um português mais simples podemos colocar uma transação dentro de outra. Veja um exemplo:</p>

<pre class="textmate-source"><span class="source source_ruby source_ruby_rails"><span class="support support_class support_class_ruby">User</span><span class="punctuation punctuation_separator punctuation_separator_method punctuation_separator_method_ruby">.</span>transaction <span class="keyword keyword_control keyword_control_start-block keyword_control_start-block_ruby">do
</span>  <span class="support support_class support_class_ruby">User</span><span class="punctuation punctuation_separator punctuation_separator_method punctuation_separator_method_ruby">.</span>create<span class="punctuation punctuation_section punctuation_section_function punctuation_section_function_ruby">(</span><span class="constant constant_other constant_other_symbol constant_other_symbol_ruby"><span class="punctuation punctuation_definition punctuation_definition_constant punctuation_definition_constant_ruby">:</span>username</span> <span class="punctuation punctuation_separator punctuation_separator_key-value">=&gt;</span> <span class="string string_quoted string_quoted_single string_quoted_single_ruby"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_ruby">'</span>Kotori<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_ruby">'</span></span><span class="punctuation punctuation_section punctuation_section_function punctuation_section_function_ruby">)</span>
  <span class="support support_class support_class_ruby">User</span><span class="punctuation punctuation_separator punctuation_separator_method punctuation_separator_method_ruby">.</span>transaction <span class="keyword keyword_control keyword_control_start-block keyword_control_start-block_ruby">do
</span>    <span class="support support_class support_class_ruby">User</span><span class="punctuation punctuation_separator punctuation_separator_method punctuation_separator_method_ruby">.</span>create<span class="punctuation punctuation_section punctuation_section_function punctuation_section_function_ruby">(</span><span class="constant constant_other constant_other_symbol constant_other_symbol_ruby"><span class="punctuation punctuation_definition punctuation_definition_constant punctuation_definition_constant_ruby">:</span>username</span> <span class="punctuation punctuation_separator punctuation_separator_key-value">=&gt;</span> <span class="string string_quoted string_quoted_single string_quoted_single_ruby"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_ruby">'</span>Nemu<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_ruby">'</span></span><span class="punctuation punctuation_section punctuation_section_function punctuation_section_function_ruby">)</span>
    <span class="keyword keyword_other keyword_other_special-method keyword_other_special-method_ruby">raise</span> <span class="support support_class support_class_ruby">ActiveRecord</span><span class="punctuation punctuation_separator punctuation_separator_other punctuation_separator_other_ruby">::</span><span class="variable variable_other variable_other_constant variable_other_constant_ruby">Rollback</span>
  <span class="keyword keyword_control keyword_control_ruby">end</span>
<span class="keyword keyword_control keyword_control_ruby">end</span>

<span class="support support_class support_class_ruby">User</span><span class="punctuation punctuation_separator punctuation_separator_method punctuation_separator_method_ruby">.</span>find<span class="punctuation punctuation_section punctuation_section_function punctuation_section_function_ruby">(</span><span class="constant constant_other constant_other_symbol constant_other_symbol_ruby"><span class="punctuation punctuation_definition punctuation_definition_constant punctuation_definition_constant_ruby">:</span>all</span><span class="punctuation punctuation_section punctuation_section_function punctuation_section_function_ruby">)</span> <span class="comment comment_line comment_line_number-sign comment_line_number-sign_ruby"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_ruby">#</span> =&gt; empty
</span></span></pre>


<p>Resumindo o exemplo acima: Criei uma transação e inclui um novo usuário no banco, então criei uma segunda transação dentro da primeira e inclui um segundo usuário, e no fim disparei uma exceção que faz com que a primeira transação e todas as suas filhas sejam desfeitas como você pode ver no resultado do método <code>find</code>.</p>

<p>A novidade é a opção <code>:requires_new</code>. Quando usada em uma sub-transação, caso alguma coisa dê errado somente as alterações feitas dai em diante é que serão desfeitas. Veja um novo exemplo, agora com este recurso habilitado:</p>

<pre class="textmate-source"><span class="source source_ruby source_ruby_rails"><span class="support support_class support_class_ruby">User</span><span class="punctuation punctuation_separator punctuation_separator_method punctuation_separator_method_ruby">.</span>transaction <span class="keyword keyword_control keyword_control_start-block keyword_control_start-block_ruby">do
</span>  <span class="support support_class support_class_ruby">User</span><span class="punctuation punctuation_separator punctuation_separator_method punctuation_separator_method_ruby">.</span>create<span class="punctuation punctuation_section punctuation_section_function punctuation_section_function_ruby">(</span><span class="constant constant_other constant_other_symbol constant_other_symbol_ruby"><span class="punctuation punctuation_definition punctuation_definition_constant punctuation_definition_constant_ruby">:</span>username</span> <span class="punctuation punctuation_separator punctuation_separator_key-value">=&gt;</span> <span class="string string_quoted string_quoted_single string_quoted_single_ruby"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_ruby">'</span>Kotori<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_ruby">'</span></span><span class="punctuation punctuation_section punctuation_section_function punctuation_section_function_ruby">)</span>
  <span class="support support_class support_class_ruby">User</span><span class="punctuation punctuation_separator punctuation_separator_method punctuation_separator_method_ruby">.</span>transaction<span class="punctuation punctuation_section punctuation_section_function punctuation_section_function_ruby">(</span><span class="constant constant_other constant_other_symbol constant_other_symbol_ruby"><span class="punctuation punctuation_definition punctuation_definition_constant punctuation_definition_constant_ruby">:</span>requires_new</span> <span class="punctuation punctuation_separator punctuation_separator_key-value">=&gt;</span> <span class="constant constant_language constant_language_ruby">true</span><span class="punctuation punctuation_section punctuation_section_function punctuation_section_function_ruby">)</span> <span class="keyword keyword_control keyword_control_start-block keyword_control_start-block_ruby">do
</span>    <span class="support support_class support_class_ruby">User</span><span class="punctuation punctuation_separator punctuation_separator_method punctuation_separator_method_ruby">.</span>create<span class="punctuation punctuation_section punctuation_section_function punctuation_section_function_ruby">(</span><span class="constant constant_other constant_other_symbol constant_other_symbol_ruby"><span class="punctuation punctuation_definition punctuation_definition_constant punctuation_definition_constant_ruby">:</span>username</span> <span class="punctuation punctuation_separator punctuation_separator_key-value">=&gt;</span> <span class="string string_quoted string_quoted_single string_quoted_single_ruby"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_ruby">'</span>Nemu<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_ruby">'</span></span><span class="punctuation punctuation_section punctuation_section_function punctuation_section_function_ruby">)</span>
    <span class="keyword keyword_other keyword_other_special-method keyword_other_special-method_ruby">raise</span> <span class="support support_class support_class_ruby">ActiveRecord</span><span class="punctuation punctuation_separator punctuation_separator_other punctuation_separator_other_ruby">::</span><span class="variable variable_other variable_other_constant variable_other_constant_ruby">Rollback</span>
  <span class="keyword keyword_control keyword_control_ruby">end</span>
<span class="keyword keyword_control keyword_control_ruby">end</span>

<span class="support support_class support_class_ruby">User</span><span class="punctuation punctuation_separator punctuation_separator_method punctuation_separator_method_ruby">.</span>find<span class="punctuation punctuation_section punctuation_section_function punctuation_section_function_ruby">(</span><span class="constant constant_other constant_other_symbol constant_other_symbol_ruby"><span class="punctuation punctuation_definition punctuation_definition_constant punctuation_definition_constant_ruby">:</span>all</span><span class="punctuation punctuation_section punctuation_section_function punctuation_section_function_ruby">)</span> <span class="comment comment_line comment_line_number-sign comment_line_number-sign_ruby"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_ruby">#</span> =&gt; Returns only Kotori</span></span></pre>


<p>Como você pode ver no retorno do método <code>find</code>, ao realizar o rollback somente a inclusão do segundo usuário foi desfeita, já que estou usando a opção <code>:requires_new</code> habilitada na segunda transação.</p>

<p>Nem todo banco de dados tem suporte real a nested transactions. Na verdade, até o momento somente o MS-SQL tem esta funcionalidade. Mas não se preocupe se você estiver usando outro banco de dados, o Active Record consegue emular nested transactions usando <a href="http://dev.mysql.com/doc/refman/5.0/en/savepoint.html">savepoints</a>.</p>

<p>ATENÇÃO: Caso você esteja usando o MySQL, então não faça operações DDL em nested transactions que estiverem emulando savepoints. Ou seja, não tente executar algo como <code>‘CREATE TABLE’</code> nestes blocos. Isto acontece porque o MySQL automaticamente libera todos os savepoints após executar uma operação DDL. Então quando a transação terminar e tentar liberar os savepoints criados, ocorrerá um erro no banco já que todos os savepoints foram liberados antes da hora. Para entender melhor, veja o exemplo abaixo:</p>

<pre class="textmate-source"><span class="source source_ruby source_ruby_rails"><span class="comment comment_line comment_line_number-sign comment_line_number-sign_ruby"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_ruby">#</span> INICIO
</span><span class="support support_class support_class_ruby">Model</span><span class="punctuation punctuation_separator punctuation_separator_method punctuation_separator_method_ruby">.</span>connection<span class="punctuation punctuation_separator punctuation_separator_method punctuation_separator_method_ruby">.</span>transaction <span class="keyword keyword_control keyword_control_start-block keyword_control_start-block_ruby">do
</span><span class="comment comment_line comment_line_number-sign comment_line_number-sign_ruby">  <span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_ruby">#</span> CRIA O SAVEPOINT active_record_1
</span>  <span class="support support_class support_class_ruby">Model</span><span class="punctuation punctuation_separator punctuation_separator_method punctuation_separator_method_ruby">.</span>connection<span class="punctuation punctuation_separator punctuation_separator_method punctuation_separator_method_ruby">.</span>transaction<span class="punctuation punctuation_section punctuation_section_function punctuation_section_function_ruby">(</span><span class="constant constant_other constant_other_symbol constant_other_symbol_ruby"><span class="punctuation punctuation_definition punctuation_definition_constant punctuation_definition_constant_ruby">:</span>requires_new</span> <span class="punctuation punctuation_separator punctuation_separator_key-value">=&gt;</span> <span class="constant constant_language constant_language_ruby">true</span><span class="punctuation punctuation_section punctuation_section_function punctuation_section_function_ruby">)</span> <span class="keyword keyword_control keyword_control_start-block keyword_control_start-block_ruby">do
</span><span class="comment comment_line comment_line_number-sign comment_line_number-sign_ruby">    <span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_ruby">#</span> active_record_1 é automaticamente liberado
</span>    <span class="support support_class support_class_ruby">Model</span><span class="punctuation punctuation_separator punctuation_separator_method punctuation_separator_method_ruby">.</span>connection<span class="punctuation punctuation_separator punctuation_separator_method punctuation_separator_method_ruby">.</span>create_table<span class="punctuation punctuation_section punctuation_section_function punctuation_section_function_ruby">(</span><span class="punctuation punctuation_separator punctuation_separator_method punctuation_separator_method_ruby">...</span><span class="punctuation punctuation_section punctuation_section_function punctuation_section_function_ruby">)</span>
  <span class="keyword keyword_control keyword_control_ruby">end</span> <span class="comment comment_line comment_line_number-sign comment_line_number-sign_ruby"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_ruby">#</span> LIBERA o savepoint active_record_1
</span>
<span class="comment comment_line comment_line_number-sign comment_line_number-sign_ruby">  <span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_ruby">#</span> ^^^^ BOOM! database error!
</span><span class="keyword keyword_control keyword_control_ruby">end</span></span></pre>


<p>Apesar deste pequeno detalhe, em todos os outros casos este recurso tem funcionado perfeitamente.</p>

<hr /><em>Todos os exemplos dados aqui funcionarão somente no <strong>Ruby on Rails 2.3 ou superior</strong>. Você pode encontrar mais detalhes sobre esta e outras novidades acompanhando a série <a href="../category/rails-23/">Rails 2.3</a>.</em>

</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/page/13/">&larr; Antigos</a>
    
    <a href="/blog/archives">Arquivo</a>
    
    <a class="next" href="/page/11/">Novos &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Artigos Recentes</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2012/01/31/mudancas-no-ruby-inside-brasil/">Mudanças no Ruby Inside Brasil</a>
      </li>
    
      <li class="post">
        <a href="/2011/11/07/ruby-em-todos-os-lugares-e-dispositivos/">Ruby em todos os lugares e dispositivos</a>
      </li>
    
      <li class="post">
        <a href="/2011/10/18/grok-podcast-extra-o-que-voce-achou/">Grok Podcast Extra - O que você achou?</a>
      </li>
    
      <li class="post">
        <a href="/2011/09/12/contratos-onde-todos-ganham/">Contratos onde todos ganham</a>
      </li>
    
      <li class="post">
        <a href="/2011/08/25/como-convencer-sua-equipe-a-usar-um-sistema-de-controle-de-vers-o/">Como convencer sua equipe a usar um sistema de controle de versão</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>Open Source</h1>
  <ul id="gh_repos">
    <li class="loading">Atualizando&#8230;</li>
  </ul>
  
  <a href="https://github.com/carlosbrando">@carlosbrando</a> no Github
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'carlosbrando',
            count: 4,
            skip_forks: false,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Últimos Tweets</h1>
  <ul id="tweets">
    <li class="loading">Atualizando&#8230;</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("carlosbrando", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/carlosbrando" class="twitter-follow-button" data-show-count="false">Siga @carlosbrando</a>
  
</section>


<section>
  <h1>Bookmarks</h1>
  <div id="delicious"></div>
  <script type="text/javascript" src="http://feeds.delicious.com/v2/json/cbrando?count=3&amp;sort=date&amp;callback=renderDeliciousLinks"></script>
  <p><a href="http://delicious.com/cbrando">Meus Bookmarks &raquo;</a></p>
</section>


<section class="googleplus googleplus-hidden">
  <h1>
    <a href="https://plus.google.com/109235566448786781079?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Carlos Brando -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'carlosbrando';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
